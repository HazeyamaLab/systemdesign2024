# 【📡 櫨研リモート開発環境用】開発環境の構築・使用方法

## 🧭 Quick Links

- [作業を再開する](#-作業を再開するには)
- [作業を終了する](#-作業を終了するには)

## 👉 開発環境の構築手順

大まかな手順は次の通りです。

1. 開発コンテナーに対応しているエディタであるVisual Studio Code（VSCode）等をインストールする。
2. 櫨研リモート開発環境のユーザを作成してログインする。
3. 開発に必要な一切がインストールされたコンテナーを開発コンテナーとして作成する。
4. 作成した開発コンテナーにVSCodeを接続し、VSCodeの設定を行う。

### 1. 必要なソフトウェアのインストール

> [!NOTE]
> 2024年度に櫨山研究室に配属された学生はこの手順を行う必要はありません。

#### Windowsの場合：

1. ターミナルまたはWindows PowerShellを起動します。
    - タスクバーの`スタート`を右クリック→`ターミナル`または`Windows PowerShell`をクリックします。
2. 次のスクリプトをPowerShellで実行してください。下記内容をコピーして、PowerShellのウィンドウを右クリックして貼り付けることもできます。すでにこれらのソフトウェアをインストールしている場合は、適宜スクリプトの内容を変更して実行してください。
    ```ps1
    # VSCode, Git をインストール
    winget install -e --id Microsoft.VisualStudioCode
    winget install -e --id Git.Git
    ```
3. インストールが完了したら（完了すると最後の行の左端が`PS C:\Users\user>`のようなプロンプトに戻ります）、インストールしたソフトウェアが正しく動作することを確認します。
    - VSCode: `スタート`→`すべてのアプリ`内に`Visual Studio Code`が追加されていて、起動できることを確認します。
    - Git: 新しいPowerShellのウィンドウを開き、次のコマンドをPowerShellで実行します。正しく動作する場合は`git version 2.44.0`のように表示されます。
        ```ps1
        git -v
        ```

#### macOSの場合

1. ターミナルを起動します。
    - Dockの`Launchpad`をクリック→`その他`→`ターミナル`の順にクリックします。
    - または、Finderを開き、メニューバーの`移動`→`アプリケーション`をクリックして`アプリケーション`フォルダを開きます。`アプリケーション`フォルダ内の`ユーティリティ`フォルダを開き、その中の`ターミナル`をダブルクリックします。
2. 次のスクリプトをターミナルで実行してください。下記内容をコピーして、ターミナルのウィンドウを右クリックして貼り付けることもできます。すでにこれらのソフトウェアをインストールしている場合は、適宜スクリプトの内容を変更して実行してください。実行中にパスワードが求められた場合は、PCにログインする際のパスワードを入力してください。
    ```sh
    # コマンドラインでソフトウェアをインストールするために Homebrew をインストール
    /bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"
    echo 'eval "$(/opt/homebrew/bin/brew shellenv)"' >> ~/.zprofile
    eval "$(/opt/homebrew/bin/brew shellenv)"
    
    # Git, Git Credential Manager, VSCode をインストール
    brew install git
    brew install --cask git-credential-manager
    brew install --cask visual-studio-code
    ```
3. インストールが完了したら（完了すると最後の行の左端が`user@macbook ~ %`のようなプロンプトに戻ります）、インストールしたソフトウェアが正しく動作することを確認します。
    - VSCode: `アプリケーション`フォルダまたは`Launchpad`に`Visual Studio Code`が追加されていて、起動できることを確認します。
    - Git: 次のコマンドをターミナルで実行します。正しく動作する場合は`git version 2.44.0`のように表示されます。
        ```sh
        git -v
        ```

### 2. 櫨研リモート開発環境のユーザを作成する

TAが巡回しますので、櫨研リモート開発環境のユーザを作成したい方はお知らせください。TAがユーザを発行してログインに必要な情報をお伝えします。

### 3. 櫨研リモート開発環境にログインして開発コンテナーを作成する

1. [櫨研リモート開発環境](https://emerald.u-gakugei.ac.jp/)にログインします。
2. ログインに成功すると、あなたが櫨研リモート開発環境上で作成した開発コンテナーの一覧が表示されます。このページはよく使うので、ブラウザのブックマークに登録しておくことをおすすめします。
3. 開発コンテナーを作成します。
    1. 手順2の画面の右上`Create Workspace`→`開発コンテナー`をクリックします。
    2. 表示された画面に次の情報を入力します。
        - `Workspace Name`: 好きな文字列を入力してください。アルファベット大文字、アルファベット小文字、数字と`-`を使用できます。
        - `Docker レジストリのホスト名`: 今回は`https://emerald.u-gakugei.ac.jp:5000`と入力します。
        - `Docker レジストリのユーザー名`: リモート開発環境の利用者に個別で連絡します。
        - `Docker レジストリのパスワード`: リモート開発環境の利用者に個別で連絡します。
        - `Git リポジトリのオーナーの名前`: 今回は`HazeyamaLab`と入力します。
        - `Git リポジトリの名前`: 今回は`systemdesign2024`と入力します。
        - `Git ブランチの名前`: 今回は`main`と入力します。
        - `devcontainer.json へのパス`: 今回は`.devcontainer/systemdesign2024-hrde/devcontainer.json`と入力します。
    3. 入力が終わったら画面右下`Create Workspace`ボタンをクリックします。
4. 開発コンテナーの作成が完了するまで待ちます。開発コンテナーの作成には数分間かかることがあります。開発コンテナーの作成に成功すると、画面中央に緑色の枠が表示されます。

### 4. 作成した開発コンテナーにVSCodeを接続し、VSCodeの設定を行う

1. VSCodeを起動します。
2. VSCodeからリモート開発環境上に作成した開発コンテナーに接続するために、Coder拡張機能をインストールします。`⇧⌘P`（`⇧`キーと`⌘`キーを押しながら`P`キーを押す）を押してコマンドパレットを開き、**`>`を消してから**`ext install coder.coder-remote`と入力して`Enter`キーを押します。
3. VSCodeでCoderにログインします（ログインしていない場合のみ）。
    1. `⇧⌘P`を押してコマンドパレットを開き、`Coder: Login`と入力して`Enter`キーを押します（途中まで入力して同名の項目を選択しても構いません）。
    2. `Enter the URL of your Coder deployment`というダイアログが表示されます。入力欄に`https://emerald.u-gakugei.ac.jp`と入力して`Enter`キーを押します。
    3. ダイアログの指示に従って、ブラウザで https://emerald.u-gakugei.ac.jp/cli-auth にアクセスし、ログイン用のコードを取得するためのページを開きます。ページ中央のボタンをクリックして、ログイン用のコードをクリップボードにコピーします。
    4. VSCodeに戻り、コピーしたログイン用のコードをダイアログに貼り付けて`Enter`キーを押します。ログインに成功すると、画面右下に`Welcome to Coder`と表示されます。
4. リモート開発環境上に作成した開発コンテナーに接続します。
    1. ブラウザのCoderの画面で開発コンテナーを開きます。
    2. `VS Code Desktop`ボタンが2つ表示されているはずです（表示されていない場合は再読み込みしてください）。内側に表示されている方の`VS Code Desktop`をクリックし、VS Codeを起動します。
    3. `'Coder' 拡張機能がこの URI を開くことを許可しますか?`と表示されることがあります。`開く`をクリックして許可してください。

## ℹ️ 開発環境の使用方法

このページには櫨研リモート開発環境特有の事柄を記します。それ以外の事柄は[README.md](../../README.md#ℹ️-開発環境の使い方)をご覧ください。

### 🧐 作業を終了するには？

VSCodeと開発コンテナーの接続を切断します。メニューバーの`File`（`ファイル`）→`Close Remote Connection`（`リモート接続を閉じる`）をクリックします。その後、VSCodeのウィンドウを閉じてVSCodeを終了します。

### 🧐 作業を再開するには？

作業内容は櫨研リモート開発環境上の開発コンテナーに保存されます。
櫨研リモート開発環境の開発コンテナーにVSCodeを接続してください。

具体的には、まず、[櫨研リモート開発環境にログイン](#3-櫨研リモート開発環境にログインして開発コンテナーを作成する)してください。ログインしたら、[作成した開発コンテナーにVSCodeを接続する](#4-作成した開発コンテナーにvscodeを接続する)の手順3以降と同じ手順で、開発コンテナーにVSCodeを接続してください。
